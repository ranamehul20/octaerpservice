import{w as p,v as q,r as o,j as e}from"./index-BOQoDeiJ.js";import{C as c,a as n}from"./CRow-DZKMKKzZ.js";import{C as A,a as M}from"./CCardBody-Dm0V9Iwv.js";import{C as T}from"./CCardHeader-C3St3R9K.js";import{C as _}from"./CForm-BmkLFAKO.js";import{a as d,C as h}from"./CFormInput-kvLYk_aa.js";import{C as g}from"./CFormSelect-B18wGbu2.js";import{a as $}from"./index.esm-BDIoaTPO.js";import{C as S}from"./CAlert-Bm5RWCiZ.js";import"./cil-user-CBnTYt-8.js";const x="http://localhost:5001/api",R=async(l,s)=>{try{const i=await p.post(`${x}/houses/${l}`,s,{withCredentials:!0});return console.log("Success",i),i.data}catch{throw error}},D=async l=>{try{const s=await p.get(`${x}/houses/${l}`,{withCredentials:!0});return console.log("Success",s),s.data}catch{throw error}},K=async l=>{try{const s=await p.get(`${x}/blocks?societyId=${selectedSociety}`,{withCredentials:!0});return console.log("Success",s),s.data}catch{throw error}},P=async l=>{try{const s=await p.get(`${x}/blocks?societyId=${selectedSociety}`,{withCredentials:!0});return console.log("Success",s),s.data}catch{throw error}},Z=()=>{const{id:l}=q(),[s,i]=o.useState({name:"",type:"",totalMembers:0,totalChildren:0,totalAdults:0,blockId:"",societyId:""}),[j,f]=o.useState(null),[v,b]=o.useState(!1),[w,N]=o.useState([]),[u,y]=o.useState(""),[I,F]=o.useState([]),[U,C]=o.useState(""),k=async()=>{try{const t=await D(l);if(t.code===200&&!t.error){const r=t.results;Object.keys(s).forEach(a=>{s[a]=r[a],a==="societyId"&&(s[a]=r[a]._id),a==="blockId"&&(s[a]=r[a]._id)}),y(r.societyId._id),C(r.blockId._id)}else console.error("Failed to fetch house details:".response.message)}catch(t){console.error("Failed to fetch house details:",t)}};o.useEffect(()=>{k()},[l]),o.useEffect(()=>{(async()=>{try{const r=await P();r.code===200&&!r.error?N(r.results):console.error("Error fetching societies:",r.error)}catch(r){console.error("Error fetching societies:",r)}})()},[]),o.useEffect(()=>{(async()=>{if(u)try{const r=await K(u);r.code===200&&!r.error?F(r.results):console.error("Error fetching blocks:",r.error)}catch(r){console.error("Error fetching blocks:",r)}})()},[u]);const m=t=>{i({...s,[t.target.name]:t.target.value})},B=t=>{y(t.target.value),i({...s,[t.target.name]:t.target.value})},E=t=>{C(t.target.value),i({...s,[t.target.name]:t.target.value})},H=async t=>{t.preventDefault(),f(null),b(!1);try{const r=await R(l,s);r.code===200&&!r.error?b(!0):f(r.message)}catch{f("Failed to create house. Please try again.")}};return e.jsx(c,{children:e.jsx(n,{xs:12,children:e.jsxs(A,{className:"mb-4",children:[e.jsx(T,{children:e.jsx("strong",{children:"Edit House"})}),e.jsxs(M,{children:[e.jsxs(_,{onSubmit:H,children:[e.jsxs(c,{className:"mb-3",children:[e.jsx(d,{htmlFor:"societyId",className:"col-sm-2 col-form-label",children:"Society"}),e.jsx(n,{sm:10,children:e.jsxs(g,{id:"societyId",name:"societyId",value:s.societyId,onChange:B,children:[e.jsx("option",{value:"",children:"Select Society"}),w.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(d,{htmlFor:"blockId",className:"col-sm-2 col-form-label",children:"Block"}),e.jsx(n,{sm:10,children:e.jsxs(g,{id:"blockId",name:"blockId",value:s.blockId,onChange:E,disabled:!u,children:[e.jsx("option",{value:"",children:"Select Block"}),I.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(d,{htmlFor:"name",className:"col-sm-2 col-form-label",children:"House Number"}),e.jsx(n,{sm:10,children:e.jsx(h,{type:"text",id:"name",name:"name",placeholder:"House Number",value:s.name,onChange:m,required:!0})})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(d,{htmlFor:"totalMembers",className:"col-sm-2 col-form-label",children:"Type"}),e.jsx(n,{sm:10,children:e.jsx(h,{type:"text",id:"type",name:"type",value:s.type,placeholder:"House Type like 2BHK, 3BHK",onChange:m,required:!0})})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(d,{htmlFor:"totalMembers",className:"col-sm-2 col-form-label",children:"Total Members"}),e.jsx(n,{sm:10,children:e.jsx(h,{type:"text",id:"totalMembers",name:"totalMembers",value:s.totalMembers,placeholder:"Total Members",onChange:m,required:!0})})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(d,{htmlFor:"totalChildren",className:"col-sm-2 col-form-label",children:"Total Children"}),e.jsx(n,{sm:10,children:e.jsx(h,{type:"text",id:"totalChildren",name:"totalChildren",value:s.totalChildren,placeholder:"Total Children",onChange:m,required:!0})})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(d,{htmlFor:"totalAdults",className:"col-sm-2 col-form-label",children:"Total Adults"}),e.jsx(n,{sm:10,children:e.jsx(h,{type:"text",id:"totalAdults",name:"totalAdults",value:s.totalAdults,placeholder:"Total Adults",onChange:m,required:!0})})]}),e.jsx($,{type:"submit",color:"primary",children:"Submit"})]}),j&&e.jsx(S,{color:"danger",className:"mt-3",children:j}),v&&e.jsx(S,{color:"success",className:"mt-3",children:"House updated successfully!"})]})]})})})};export{Z as default};
